<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>文章后台管理</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body { font-family: Arial, sans-serif; background: #f8f8f8; margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center; }
    h1 { font-size: 24px; display: flex; align-items: center; gap: 10px; }
    .btn { padding: 8px 16px; background: #333; color: #fff; border: none; cursor: pointer; margin-right: 5px; }
    .btn:hover { background: #555; }
    .hidden { display: none; }
    textarea, input[type="text"], input[type="file"] { width: 100%; margin: 5px 0; }
    table { width: 100%; max-width: 960px; border-collapse: collapse; margin-top: 20px; background: #fff; }
    th, td { padding: 10px; border: 1px solid #ddd; text-align: left; }
    th { background: #f0f0f0; }
    .admin-bar { display: flex; justify-content: space-between; align-items: center; max-width: 960px; width: 100%; margin-bottom: 20px; flex-wrap: wrap; }
    .admin-bar > input { flex: 1; min-width: 200px; margin: 5px; }
    .admin-bar > div { display: flex; gap: 8px; flex-wrap: wrap; justify-content: flex-end; min-width: 200px; margin: 5px; }
    #previewModal { position: fixed; top: 10%; left: 50%; transform: translateX(-50%); background: white; padding: 20px; border: 1px solid #ccc; max-width: 700px; width: 90%; z-index: 999; overflow-y: auto; max-height: 80vh; }
    #previewModal h3 { margin-top: 0; }
    #previewModal img { max-width: 100%; }
    #markdownContent { white-space: pre-wrap; }
    @media (max-width: 768px) {
      .admin-bar { flex-direction: column; align-items: stretch; }
      .btn, textarea { width: 100%; margin: 5px 0; }
      table, thead, tbody, th, td, tr { display: block; }
      thead { display: none; }
      tbody tr { border: 1px solid #ddd; margin-bottom: 15px; background: #fff; padding: 10px; }
      tbody td { display: flex; justify-content: space-between; padding: 8px 5px; border: none; border-bottom: 1px solid #eee; }
      tbody td::before { content: attr(data-label); font-weight: bold; color: #555; flex: 1; margin-right: 10px; }
      #submitBtn, #cancelEditBtn { width: 100%; }
    }
  </style>
</head>
<body>
<h1>📃 文章后台管理</h1>
<div id="authArea"><button id="loginBtn" class="btn">使用 GitHub 登录</button></div>
<div id="adminArea" class="hidden">
  <div class="admin-bar">
    <input type="text" id="searchInput" placeholder="搜索标题关键词…" />
    <div>
      <button id="searchBtn" class="btn">🔍 搜索</button>
      <button id="logoutBtn" class="btn">退出登录</button>
    </div>
  </div>
  <h2>🆕 新增/编辑文章</h2>
  <input type="text" id="newTitle" placeholder="标题" />
  <textarea id="newContent" placeholder="支持 Markdown 格式的内容"></textarea>
  <input type="file" id="coverInput" accept="image/*" />
  <div style="display: flex; gap: 10px; margin-bottom: 10px; flex-wrap: wrap;">
    <button id="submitBtn" class="btn">提交</button>
    <button id="cancelEditBtn" class="btn hidden">取消编辑</button>
  </div>
  <div style="overflow-x: auto; width: 100%;">
    <table id="articlesTable">
      <thead>
        <tr><th>标题</th><th>作者</th><th>内容</th><th>创建时间</th><th>更新时间</th><th>星期</th><th>封面</th><th>操作</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
  <div id="previewModal" class="hidden">
    <h3 id="previewTitle"></h3>
    <img id="previewCover" />
    <div id="markdownContent"></div>
    <button class="btn" onclick="closePreview()">关闭</button>
  </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script>
const API_BASE = 'https://api.oliverfr.com/api';
const ADMIN_EMAIL = 'oliveroogle@gmail.com';
if (location.hash.includes('access_token')) {
  history.replaceState(null, '', '/admin-mefan-articles.html');
  location.reload();
}
</script>
<script src="/public/admin-mefan-articles.js"></script>
</body>
</html>
